---
import Layout from '../layouts/Page.astro';
import { Container } from '@components/odyssey-theme';
import MetricCard from '../components/dashboard/MetricCard.astro';
import DashboardGrid from '../components/dashboard/DashboardGrid.astro';
import LoadingState from '../components/dashboard/LoadingState.astro';
import EmptyState from '../components/dashboard/EmptyState.astro';
import StatusBadge from '../components/dashboard/StatusBadge.astro';

const seo = {
  title: 'Dashboard | Automation Dashboard',
  description: 'Dashboard overview and analytics',
};

// In a production environment, you would fetch this data from your API/database
// For now, using placeholder data that demonstrates the structure
let isLoading = false;
let error = null;

// Note: In production, you would fetch data here using Astro server endpoints
// Connect to your backend API or database to get real data

// Placeholder recent activity data
const recentActivity = [
  {
    id: '1',
    type: 'call',
    title: 'Call with John Doe',
    status: 'completed' as const,
    timestamp: new Date(Date.now() - 1000 * 60 * 5).toISOString(),
  },
  {
    id: '2',
    type: 'lead',
    title: 'New lead: Jane Smith',
    status: 'new' as const,
    timestamp: new Date(Date.now() - 1000 * 60 * 30).toISOString(),
  },
  {
    id: '3',
    type: 'upload',
    title: 'CSV import completed',
    status: 'completed' as const,
    timestamp: new Date(Date.now() - 1000 * 60 * 60).toISOString(),
  },
];

const metrics = [
  {
    title: 'Total Leads',
    value: 124,
    change: 12,
    changeLabel: 'this month',
    icon: 'mdi:account-group',
  },
  {
    title: 'Calls Today',
    value: 23,
    change: 5,
    changeLabel: 'vs yesterday',
    icon: 'mdi:phone',
  },
  {
    title: 'Conversion Rate',
    value: '18.5%',
    change: 2.3,
    changeLabel: 'this week',
    icon: 'mdi:chart-line',
  },
  {
    title: 'Active Tasks',
    value: 8,
    change: -2,
    changeLabel: 'this week',
    icon: 'mdi:check-circle',
  },
];
---

<Layout {seo}>
  <Container>
    <div class="dashboard-header">
      <h1>Dashboard Overview</h1>
      <p class="dashboard-subtitle">Monitor your data, leads, and activity at a glance</p>
    </div>

    {isLoading ? (
      <LoadingState message="Loading dashboard data..." />
    ) : error ? (
      <div class="dashboard-error">
        <p>Unable to load dashboard data. Please check your configuration.</p>
        <p class="dashboard-error__hint">Configure your API endpoints and database connections in the settings.</p>
      </div>
    ) : (
      <>
        <DashboardGrid columns={4}>
          {metrics.map((metric) => (
            <MetricCard {...metric} />
          ))}
        </DashboardGrid>

        <section class="dashboard-section">
          <div class="dashboard-section__header">
            <h2>Recent Activity</h2>
            <a href="/call-history" class="dashboard-section__link">View All</a>
          </div>
          {recentActivity.length > 0 ? (
            <div class="activity-list">
              {recentActivity.map((activity) => (
                <div class="activity-item">
                  <div class="activity-item__icon">
                    {activity.type === 'call' && 'üìû'}
                    {activity.type === 'lead' && 'üë§'}
                    {activity.type === 'upload' && 'üì§'}
                  </div>
                  <div class="activity-item__content">
                    <strong class="activity-item__title">{activity.title}</strong>
                    <span class="activity-item__time">
                      {new Date(activity.timestamp).toLocaleString()}
                    </span>
                  </div>
                  <StatusBadge 
                    status={activity.status === 'completed' ? 'success' : activity.status === 'new' ? 'waiting' : 'running'} 
                    label={activity.status}
                  />
                </div>
              ))}
            </div>
          ) : (
            <EmptyState
              title="No recent activity"
              message="Your recent calls and activities will appear here."
              actionLabel="View Call History"
              actionHref="/call-history"
            />
          )}
        </section>

        <section class="dashboard-section">
          <h2>Quick Actions</h2>
          <div class="dashboard-actions">
            <a href="/leads" class="dashboard-action">
              <span class="dashboard-action__icon">üë•</span>
              <span class="dashboard-action__text">Manage Leads</span>
            </a>
            <a href="/call-history" class="dashboard-action">
              <span class="dashboard-action__icon">üìû</span>
              <span class="dashboard-action__text">Call History</span>
            </a>
            <a href="/upload-csv" class="dashboard-action">
              <span class="dashboard-action__icon">üì§</span>
              <span class="dashboard-action__text">Upload CSV</span>
            </a>
            <a href="/settings" class="dashboard-action">
              <span class="dashboard-action__icon">‚öôÔ∏è</span>
              <span class="dashboard-action__text">Settings</span>
            </a>
          </div>
        </section>
      </>
    )}
  </Container>
</Layout>

<style>
  .dashboard-header {
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .dashboard-header h1 {
    font-size: 2rem;
    font-weight: 700;
    color: var(--theme-on-bg);
    margin: 0 0 0.5rem 0;
    line-height: 1.3;
  }

  .dashboard-subtitle {
    font-size: 1rem;
    color: var(--theme-on-bg);
    opacity: 0.7;
    margin: 0;
    line-height: 1.5;
  }

  .dashboard-section {
    margin-top: 2.5rem;
  }

  .dashboard-section__header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
  }

  .dashboard-section__header h2 {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--theme-on-bg);
    margin: 0;
    line-height: 1.3;
  }

  .dashboard-section__link {
    color: var(--theme-primary);
    text-decoration: none;
    font-weight: 500;
    font-size: 0.875rem;
  }

  .dashboard-section__link:hover {
    text-decoration: underline;
  }

  .dashboard-error {
    background: var(--theme-surface-1);
    border-radius: var(--theme-shape-radius);
    padding: 2rem;
    text-align: center;
    color: var(--theme-on-surface-1);
  }

  .dashboard-error__hint {
    margin-top: 1rem;
    font-size: 0.875rem;
    opacity: 0.7;
  }

  .dashboard-actions {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
  }

  .dashboard-action {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.75rem;
    padding: 1.5rem;
    background: var(--theme-surface-1);
    border-radius: var(--theme-shape-radius);
    text-decoration: none;
    color: var(--theme-on-surface-1);
    transition: transform var(--theme-transition), box-shadow var(--theme-transition);
  }

  .dashboard-action:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  .dashboard-action__icon {
    font-size: 2rem;
    line-height: 1;
  }

  .dashboard-action__text {
    font-weight: 500;
    font-size: 0.9375rem;
  }

  .activity-list {
    background: var(--theme-surface-1);
    border-radius: var(--theme-shape-radius);
    overflow: hidden;
  }

  .activity-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.25rem 1.5rem;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    transition: background-color var(--theme-transition);
  }

  .activity-item:last-child {
    border-bottom: none;
  }

  .activity-item:hover {
    background: rgba(0, 0, 0, 0.02);
  }

  .activity-item__icon {
    font-size: 1.5rem;
    flex-shrink: 0;
  }

  .activity-item__content {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .activity-item__title {
    color: var(--theme-on-surface-1);
    font-weight: 500;
    font-size: 0.9375rem;
  }

  .activity-item__time {
    font-size: 0.8125rem;
    color: var(--theme-on-surface-1);
    opacity: 0.6;
  }

  @media (max-width: 768px) {
    .dashboard-header h1 {
      font-size: 1.75rem;
    }

    .dashboard-actions {
      grid-template-columns: 1fr;
    }

    .activity-item {
      padding: 1rem;
    }
  }
</style>
