---
import Layout from '../../layouts/Page.astro';
import { Container, Button } from '@components/odyssey-theme';
import StatusBadge from '../../components/dashboard/StatusBadge.astro';
import EmptyState from '../../components/dashboard/EmptyState.astro';
import { formatDistanceToNow } from 'date-fns';

const seo = {
  title: 'Leads | Dashboard',
  description: 'Manage your leads and prospects',
};

// Placeholder leads data
const leads = [
  {
    id: 'lead-1',
    name: 'John Doe',
    email: 'john.doe@example.com',
    phone: '+1 (555) 123-4567',
    company: 'Acme Corp',
    status: 'new',
    source: 'Website',
    createdAt: new Date(Date.now() - 1000 * 60 * 60 * 24).toISOString(),
    lastContact: new Date(Date.now() - 1000 * 60 * 60 * 12).toISOString(),
  },
  {
    id: 'lead-2',
    name: 'Jane Smith',
    email: 'jane.smith@example.com',
    phone: '+1 (555) 234-5678',
    company: 'Tech Solutions Inc',
    status: 'contacted',
    source: 'Referral',
    createdAt: new Date(Date.now() - 1000 * 60 * 60 * 48).toISOString(),
    lastContact: new Date(Date.now() - 1000 * 60 * 60 * 2).toISOString(),
  },
  {
    id: 'lead-3',
    name: 'Bob Johnson',
    email: 'bob.johnson@example.com',
    phone: '+1 (555) 345-6789',
    company: 'Global Industries',
    status: 'qualified',
    source: 'Cold Call',
    createdAt: new Date(Date.now() - 1000 * 60 * 60 * 72).toISOString(),
    lastContact: new Date(Date.now() - 1000 * 60 * 60 * 6).toISOString(),
  },
  {
    id: 'lead-4',
    name: 'Alice Williams',
    email: 'alice.williams@example.com',
    phone: '+1 (555) 456-7890',
    company: 'StartupXYZ',
    status: 'converted',
    source: 'Website',
    createdAt: new Date(Date.now() - 1000 * 60 * 60 * 96).toISOString(),
    lastContact: new Date(Date.now() - 1000 * 60 * 60 * 24).toISOString(),
  },
];

function formatTime(timestamp: string): string {
  try {
    return formatDistanceToNow(new Date(timestamp), { addSuffix: true });
  } catch {
    return timestamp;
  }
}

function getStatusBadge(status: string): 'success' | 'error' | 'running' | 'waiting' | 'canceled' {
  switch (status) {
    case 'converted':
      return 'success';
    case 'qualified':
      return 'running';
    case 'contacted':
      return 'waiting';
    case 'new':
      return 'waiting';
    default:
      return 'waiting';
  }
}

function getStatusLabel(status: string): string {
  return status.charAt(0).toUpperCase() + status.slice(1);
}
---

<Layout {seo}>
  <Container>
    <div class="leads-header">
      <div>
        <h1>Leads</h1>
        <p class="leads-subtitle">Manage and track your leads and prospects</p>
      </div>
      <div class="leads-header-actions">
        <Button href="/leads/new" variant="outline">Add Lead</Button>
        <Button href="/leads/import">Import Leads</Button>
      </div>
    </div>

    {leads.length > 0 ? (
      <div class="leads-container">
        <table class="leads-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Company</th>
              <th>Contact</th>
              <th>Status</th>
              <th>Source</th>
              <th>Last Contact</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {leads.map((lead) => (
              <tr>
                <td class="leads__name">
                  <strong>{lead.name}</strong>
                </td>
                <td class="leads__company">{lead.company}</td>
                <td class="leads__contact">
                  <div class="leads__contact-info">
                    <a href={`mailto:${lead.email}`} class="leads__email">{lead.email}</a>
                    <span class="leads__phone">{lead.phone}</span>
                  </div>
                </td>
                <td>
                  <StatusBadge status={getStatusBadge(lead.status)} label={getStatusLabel(lead.status)} />
                </td>
                <td class="leads__source">{lead.source}</td>
                <td class="leads__time">{formatTime(lead.lastContact)}</td>
                <td>
                  <a href={`/leads/${lead.id}`} class="leads__link">View</a>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    ) : (
      <EmptyState
        title="No leads yet"
        message="Start adding leads to track your prospects and manage your sales pipeline."
        actionLabel="Add Lead"
        actionHref="/leads/new"
      />
    )}
  </Container>
</Layout>

<style>
  .leads-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    gap: 1rem;
    flex-wrap: wrap;
  }

  .leads-header h1 {
    font-size: 2rem;
    font-weight: 700;
    color: var(--theme-on-bg);
    margin: 0 0 0.5rem 0;
    line-height: 1.3;
  }

  .leads-subtitle {
    font-size: 1rem;
    color: var(--theme-on-bg);
    opacity: 0.7;
    margin: 0;
    line-height: 1.5;
  }

  .leads-header-actions {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
  }

  .leads-container {
    background: var(--theme-surface-1);
    border-radius: var(--theme-shape-radius);
    overflow: hidden;
  }

  .leads-table {
    width: 100%;
    border-collapse: collapse;
  }

  .leads-table thead {
    background: var(--theme-surface-2);
  }

  .leads-table th {
    padding: 1rem;
    text-align: left;
    font-weight: 600;
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--theme-on-surface-2);
  }

  .leads-table tbody tr {
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    transition: background-color var(--theme-transition);
  }

  .leads-table tbody tr:hover {
    background: rgba(0, 0, 0, 0.02);
  }

  .leads-table td {
    padding: 1rem;
    color: var(--theme-on-surface-1);
  }

  .leads__name strong {
    color: var(--theme-on-surface-1);
    font-weight: 600;
    font-size: 0.9375rem;
  }

  .leads__company {
    color: var(--theme-on-surface-1);
    opacity: 0.8;
  }

  .leads__contact-info {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .leads__email {
    color: var(--theme-primary);
    text-decoration: none;
    font-size: 0.875rem;
  }

  .leads__email:hover {
    text-decoration: underline;
  }

  .leads__phone {
    font-family: monospace;
    font-size: 0.8125rem;
    color: var(--theme-on-surface-1);
    opacity: 0.7;
  }

  .leads__source {
    font-size: 0.875rem;
    color: var(--theme-on-surface-1);
    opacity: 0.8;
  }

  .leads__time {
    font-size: 0.875rem;
    opacity: 0.8;
    color: var(--theme-on-surface-1);
  }

  .leads__link {
    color: var(--theme-primary);
    text-decoration: none;
    font-weight: 500;
    font-size: 0.875rem;
  }

  .leads__link:hover {
    text-decoration: underline;
  }

  @media (max-width: 768px) {
    .leads-header {
      flex-direction: column;
    }

    .leads-header h1 {
      font-size: 1.75rem;
    }

    .leads-header-actions {
      width: 100%;
    }

    .leads-header-actions :global(button) {
      flex: 1;
    }

    .leads-table {
      font-size: 0.875rem;
    }

    .leads-table th,
    .leads-table td {
      padding: 0.75rem 0.5rem;
    }
  }
</style>

